## 1 准备

参考：https://blog.csdn.net/alinyua/article/details/79476365

### 1.1 认证流程

浏览器		服务器
发起	—> 1.浏览器通知服务器浏览器所支持的加密协议	接收
接收	<— 2.服务器通知浏览器从1中选用的加密协议,并给予证书	发起
3.用CA的公钥鉴别服务器的证书是否有效,有效则生成一个随机数(秘密数),秘密数加上2确定的加密协议产生会话密钥		
发起	—> 4.浏览器用服务器的公钥加密秘密数发给服务器	接收
5.服务器用私钥对4解密获得秘密数再加上2确定的加密协议产生会话密钥
<— 握手结束,使用相同的会话密钥加密传输的数据(对称加密) —>	

### 1.2 SSL/TLS

> SSL：应用层
>
> TSL：传输层
>
> 区别：TLS的主要目标是使SSL更安全，并使协议的规范更精准和完善

### 1.3 CA证书理解

> - 什么是证书？
>
> 　　“证书”洋文也叫“digital certificate”或“public key certificate”（专业的解释看“这里”）。
> 　　它是用来证明某某东西确实是某某东西的东西（是不是像绕口令？）。通俗地说，证书就好比例子里面的公章。通过公章，可以证明该介绍信确实是对应的公司发出的。
> 　　理论上，人人都可以找个证书工具，自己做一个证书。那如何防止坏人自己制作证书出来骗人捏？请看后续 CA 的介绍。
>
> - 什么是CA？
>
> 　　CA是Certificate Authority的缩写，也叫“证书授权中心”。（专业的解释看“这里”）
> 　　它是负责管理和签发证书的第三方机构，就好比例子里面的中介——C 公司。一般来说，CA必须是所有行业和所有公众都信任的、认可的。因此它必须具有足够的权威性。就好比A、B两公司都必须信任C公司，才会找 C 公司作为公章的中介。
>
> - 什么是CA证书？
>
> 　　CA 证书，顾名思义，就是CA颁发的证书。
> 　　前面已经说了，人人都可以找工具制作证书。但是你一个小破孩制作出来的证书是没啥用处的。因为你不是权威的CA机关，你自己搞的证书不具有权威性。
> 　　这就好比上述的例子里，某个坏人自己刻了一个公章，盖到介绍信上。但是别人一看，不是受信任的中介公司的公章，就不予理睬。坏蛋的阴谋就不能得逞啦。
> 　　文本后续提及的证书，若无特殊说明，均指 CA 证书。
>
> - 什么是证书之间的信任关系？
>
> 　　在俺的例子里谈到，引入中介后，业务员要同时带两个介绍信。第一个介绍信包含了两个公章，并注明，公章C信任公章A。证书间的信任关系，就和这个类似。就是用一个证书来证明另一个证书是真实可信滴。
>
> - 什么是证书信任链？
>
> 　　实际上，证书之间的信任关系，是可以嵌套的。比如，C 信任 A1，A1 信任 A2，A2 信任 A3……这个叫做证书的信任链。只要你信任链上的头一个证书，那后续的证书，都是可以信任滴。
>
> - 什么是根证书？
>
> 　　“根证书”的洋文叫“root certificate”，专业的解释看“这里”。为了说清楚根证书是咋回事，再来看个稍微复杂点的例子。
> 　　假设 C 证书信任 A 和 B；然后 A 信任 A1 和 A2；B 信任 B1 和 B2。则它们之间，构成如下的一个树形关系（一个倒立的树）。
> 　　处于最顶上的树根位置的那个证书，就是“根证书”。除了根证书，其它证书都要依靠上一级的证书，来证明自己。那谁来证明“根证书”可靠捏？实际上，根证书自己证明自己是可靠滴（或者换句话说，根证书是不需要被证明滴）。
>
> - CA证书在SSL中的作用?
>
> 客户端需要对服务端的证书进行检查，如果证书不是可信机构颁布、或者证书中的域名与实际域名不一致、或者证书已经过期，就会向访问者显示一个警告，由其选择是否还要继续通信。如果证书没有问题，客户端就会从服务器证书中取出服务器的公钥(公钥从证书中获取,证书的正确性由CA保证)

### 1.4 单向认证/双向认证

> - 单向认证，就是传输的数据加密过了，但是不会校验客户端来源
> - 双向认证，如果客户端浏览器没有导入客户端证书，是访问不了web系统的，找不到地址，如果只是加密，我感觉用单向就行了。如果想要用系统的人没有证书就访问不了系统的话，就采用双向
> - 采用自己签发的证书，可以不用去CA机构申请，因为只是内部客户端间调用（数字证书绑定了公钥、数字签名，以及持有者的真实身份）

## 2 spring单/双向认证

### 2.1 准备

证书工具openssl和keytool

### 2.2 生成

参考：https://www.cnblogs.com/xdp-gacl/p/3750965.html https://www.freesion.com/article/63311407015/

### 2.3 效果

#### 2.3.1 未配置证书

#### 2.3.2 配置证书

> 浏览器导入证书，再访问https://127.0.0.1/example/hello

##### 2.3.2.1 单向认证

##### 2.3.2.2 双向认证

#### 2.4 浏览器查看证书